{%- doc -%}
  This snippet is used to render the product grid on collection and search pages.
  @param {object} [paginate] - Pagination object
{%- enddoc -%}

{% assign block_settings = block.settings %}

{% if paginate.current_page != 1 or block.settings.collection_featured_card == blank %}
    {% break %}
{% endif %}


{% liquid
  assign product_card_id = 'product-card-link-' | append: block.id
  assign product_card_gap_value = block_settings.product_card_gap
%}

{% capture children %}
  {% content_for 'blocks', closest.product: product %}
{% endcapture %}

{% assign object = block_settings.collection_featured_card %}

<li
    id="{{ section.id }}-featured-card"
    class="product-grid__item product-grid__item--0"
    data-page="{{ paginate.current_page }}"
    ref="cards[]"
>
    <featured-card
    class="product-card featured-card"
    id="product-card-{{ block.id }}"
    {{ block.shopify_attributes }}
    >

    {% unless object.title_link == blank %}
        <a
            id="{{ product_card_id | md5 }}"
            href="{{ object.title_link.value.url }}"
            class="product-card__link"
            ref="productCardLink"
        >
            <span class="visually-hidden">
                {{ object.title_link.value.text }}
            </span>
        </a>
    {% endunless %}
    <div
        class="
        product-card__content
        layout-panel-flex
        layout-panel-flex--column
        product-grid__card
        spacing-style
        border-style
        gap-style
        {% if block_settings.inherit_color_scheme == false %} color-{{ block_settings.color_scheme }}{% endif %}
        "
        style="
        {% render 'border-override', settings: block_settings %}
        {% render 'layout-panel-style', settings: block_settings %}
        {% render 'spacing-style', settings: block_settings %}
        {% render 'gap-style', value: product_card_gap_value, name: 'product-card-gap' %}
        --quick-add-display: none;
        --quick-add-mobile-display: none;
        {% if block_settings.padding-inline-start > 0 %}--zoom-out-padding-inline-start: min(var(--padding-xs), {{ block_settings.padding-inline-start | times: 0.7}}px);{% endif %}
        {% if block_settings.padding-inline-end > 0 %}--zoom-out-padding-inline-end: min(var(--padding-xs), {{ block_settings.padding-inline-end | times: 0.7}}px);{% endif %}
        {% if block_settings.padding-block-start > 0 %}--zoom-out-padding-block-start: min(var(--padding-xs), {{ block_settings.padding-block-start | times: 0.7}}px);{% endif %}
        {% if block_settings.padding-block-end > 0 %}--zoom-out-padding-block-end: min(var(--padding-xs), {{ block_settings.padding-block-end | times: 0.7}}px);{% endif %}
        "
    >
        {% content_for 'block', type: '_object-image', id: 'object-image' %}
        {% if object.badge_texts.value.size > 0 %}
            <div
                class="product-badges {% if object.badge_texts.value.size > 1 %}flex-badges{% endif %} product-badges--{{ settings.badge_position }}"
                style="
                    --badge-border-radius: {{ settings.badge_corner_radius }}px;
                    --badge-font-family: var(--font-{{ settings.badge_font_family }}--family); --badge-font-weight: var(--font-{{ settings.badge_font_family }}--weight); --badge-text-transform: {{ settings.badge_text_transform }};
                "
            >
                {% for i in object.badge_texts.value %}
                    <div
                        class="product-badges__badge product-tag__badge product-badges__badge--rectangle color-{{ settings.badge_sale_color_scheme }}"
                    >
                        {{  i }}
                    </div>
                {% endfor %}
            </div>
        {% endif %}
        {{ children }}
    </div>
    </featured-card>
</li>

{% stylesheet %}
    .featured-card xb-wishlist-button-collection {
        display: none;
    }
    .featured-card .product-card__link {
        z-index: 2;
    }

    /* Make product media go edge-to-edge by using negative margins */
    :is(.collection-wrapper--full-width) .featured-card .object-image,
    :is(.collection-wrapper--full-width-on-mobile) .featured-card .object-image {
        @media screen and (max-width: 749px) {
            margin-inline-start: calc(-1 * max(var(--padding-xs), var(--padding-inline-start)));
            margin-inline-end: calc(-1 * max(var(--padding-xs), var(--padding-inline-end)));
        }
    }

  :is(.collection-wrapper--full-width, .collection-wrapper--full-width-on-mobile)
    [product-grid-view='default']
    .product-grid__card {
    @media screen and (max-width: 749px) {
      padding-inline-start: max(var(--padding-xs), var(--padding-inline-start));
      padding-inline-end: max(var(--padding-xs), var(--padding-inline-end));
    }
  }
{% endstylesheet %}
{% schema %}
{
  "name": "Featured card",
  "tag": null,
  "blocks": [
    {
      "type": "text"
    },
    {
      "type": "custom-liquid"
    },
    {
      "type": "@app"
    }
  ],
  "settings": [
    {
        "type": "metaobject",
        "id": "collection_featured_card",
        "label": "Featured Card",
        "metaobject_type": "collection_featured_card"
    },
    {
      "type": "range",
      "id": "product_card_gap",
      "label": "t:settings.vertical_gap",
      "min": 0,
      "max": 50,
      "step": 1,
      "unit": "px",
      "default": 16
    },
    {
      "type": "checkbox",
      "id": "inherit_color_scheme",
      "label": "t:settings.inherit_color_scheme",
      "default": true
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:settings.color_scheme",
      "default": "scheme-1",
      "visible_if": "{{ block.settings.inherit_color_scheme == false }}"
    },
    {
      "type": "header",
      "content": "t:content.borders"
    },
    {
      "type": "select",
      "id": "border",
      "label": "t:settings.style",
      "options": [
        {
          "value": "none",
          "label": "t:options.none"
        },
        {
          "value": "solid",
          "label": "t:options.solid"
        }
      ],
      "default": "none"
    },
    {
      "type": "range",
      "id": "border_width",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "label": "t:settings.thickness",
      "default": 1,
      "visible_if": "{{ block.settings.border != 'none' }}"
    },
    {
      "type": "range",
      "id": "border_opacity",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "%",
      "label": "t:settings.opacity",
      "default": 100,
      "visible_if": "{{ block.settings.border != 'none' }}"
    },
    {
      "type": "range",
      "id": "border_radius",
      "label": "t:settings.border_radius",
      "min": 0,
      "max": 32,
      "step": 1,
      "default": 0
    },
    {
      "type": "header",
      "content": "t:content.padding"
    },
    {
      "type": "range",
      "id": "padding-block-start",
      "label": "t:settings.top",
      "min": 0,
      "max": 50,
      "step": 1,
      "unit": "px",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding-block-end",
      "label": "t:settings.bottom",
      "min": 0,
      "max": 50,
      "step": 1,
      "unit": "px",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding-inline-start",
      "label": "t:settings.left",
      "min": 0,
      "max": 50,
      "step": 1,
      "unit": "px",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding-inline-end",
      "label": "t:settings.right",
      "min": 0,
      "max": 50,
      "step": 1,
      "unit": "px",
      "default": 0
    }
  ],
  "presets": [
    {
      "name": "Featured card",
      "category": "t:categories.layout"
    }
  ]
}
{% endschema %}